import React, { useState, useEffect } from 'react';
import { useAuth } from '../contexts/AuthContext';
import QuestionInput from '../../components/QuestionInput';
import AnswerDisplay from '../../components/AnswerDisplay';
import AnswerGranularitySelector, { Granularity } from '../../components/AnswerGranularitySelector';
import SuggestedFollowUpQuestions from '../../components/SuggestedFollowUpQuestions';
import UserInsightDisplay from '../../components/UserInsightDisplay';
import FaqItem from '../../components/FaqItem';
import { KNOWLEDGE_BASE } from '../../constants';
import { QAItem } from '../../types';

// AI回答生成のヘルパー関数
const findMostRelevantFAQ = (question: string): QAItem | null => {
  const questionLower = question.toLowerCase();
  let bestMatch: QAItem | null = null;
  let bestScore = 0;

  KNOWLEDGE_BASE.forEach(faq => {
    let score = 0;
    
    // キーワードマッチング
    faq.keywords.forEach(keyword => {
      if (questionLower.includes(keyword.toLowerCase())) {
        score += 3;
      }
    });
    
    // 質問内容のマッチング
    if (questionLower.includes(faq.question.toLowerCase())) {
      score += 5;
    }
    
    // カテゴリマッチング
    if (questionLower.includes(faq.category.toLowerCase())) {
      score += 2;
    }
    
    if (score > bestScore) {
      bestScore = score;
      bestMatch = faq;
    }
  });

  return bestScore > 2 ? bestMatch : null;
};

const generateAnswerByGranularity = (faq: QAItem, granularity: Granularity): string => {
  const baseAnswer = faq.answer;
  
  switch (granularity) {
    case 'concise':
      // WebデザイナーとUI/UXデザイナーの違いについて特別な処理
      if (faq.question.includes('Webデザイナー') && faq.question.includes('UI/UXデザイナー')) {
        return `# WebデザイナーとUI/UXデザイナーの違い

## 質問

${faq.question}

## 要点

${baseAnswer.split('\n')[0]}

## 主要な違い

- **役割**: WebデザイナーはWebサイト、UI/UXデザイナーはアプリ・プロダクト
- **スキル**: WebデザイナーはHTML/CSS、UI/UXデザイナーはプロトタイピングツール
- **採用チャネル**: Webデザイナーはエージェンシー、UI/UXデザイナーは転職サービス

## キーポイント

${faq.keywords.slice(0, 3).map(k => `- ${k}`).join('\n')}`;
      }
      
      return `# 簡潔な回答

## 質問

${faq.question}

## 要点

${baseAnswer.split('\n')[0]}

## キーポイント

${faq.keywords.slice(0, 3).map(k => `- ${k}`).join('\n')}`;
    
    case 'contextual':
      return generateContextualAnswer(faq);
    
    case 'detailed':
      return generateDetailedAnswer(faq);
    
    default:
      return baseAnswer;
  }
};

const generateContextualAnswer = (faq: QAItem): string => {
  const baseAnswer = faq.answer;
  
  // WebデザイナーとUI/UXデザイナーの違いについて特別な処理
  if (faq.question.includes('Webデザイナー') && faq.question.includes('UI/UXデザイナー')) {
    return `# WebデザイナーとUI/UXデザイナーの違い

## 回答

${baseAnswer}

## 詳細な違い

### 1. 役割と責任の違い

**Webデザイナー**
- コーポレートサイト、ランディングページ、ECサイトなどのWebサイト全体のデザイン
- ブランディング、ビジュアルデザイン、レイアウト設計が中心
- HTML/CSSの実装スキルも重要
- 企業のブランドイメージを視覚的に表現

**UI/UXデザイナー**
- Webアプリケーション、モバイルアプリ、SaaS製品などのUI/UX設計
- ユーザビリティ、ユーザー体験、インタラクションデザインが中心
- プロトタイピングツール（Figma、Sketch等）の高度なスキル
- データ駆動のデザイン意思決定

### 2. スキルセットの違い

**Webデザイナー**
- Adobe Creative Suite（Photoshop、Illustrator）
- HTML/CSS/JavaScriptの基礎知識
- レスポンシブデザイン
- SEOを考慮したデザイン

**UI/UXデザイナー**
- Figma、Sketch、Adobe XD
- ユーザーリサーチ、ペルソナ設定
- ワイヤーフレーム、プロトタイプ作成
- A/Bテスト、ユーザビリティテスト

### 3. 採用チャネルの違い

**Webデザイナー**
- デザインエージェンシー（クリエイターズ、デザインエージェンシー等）
- 企業のWeb制作部門
- フリーランス案件（クラウドソーシング等）

**UI/UXデザイナー**
- Wantedly、ビズリーチ等の転職サービス
- スタートアップ、IT企業のプロダクトチーム
- 大手企業のデジタル部門

### 4. キャリアパスの違い

**Webデザイナー**
- アートディレクター
- クリエイティブディレクター
- フリーランスWebデザイナー

**UI/UXデザイナー**
- プロダクトデザイナー
- UXリサーチャー
- デザインシステム管理者

## 背景と重要性

この違いを理解することは、採用戦略において非常に重要です。適切な人材を適切なポジションに配置することで、プロジェクトの成功確率が大幅に向上します。

## 実践的なポイント

- 求人票で役割を明確に分ける
- スキル要件を具体的に記載する
- 採用後のキャリアパスを提示する
- 適切な給与体系を設定する

---

## 詳細分析

### 市場での需要動向

**Webデザイナー**
- 企業のデジタル化需要により安定した需要
- 特に中小企業での需要が高い
- フリーランス案件も豊富

**UI/UXデザイナー**
- デジタルプロダクトの重要性増加により急激な需要増
- スタートアップ、IT企業での需要が特に高い
- 給与水準も全体的に高い

### 教育・研修の違い

**Webデザイナー**
- デザインスクール、専門学校での教育が一般的
- 実践的なスキル習得が重視される

**UI/UXデザイナー**
- 大学院での専門教育、オンラインコース
- 理論と実践の両方が重要

## 実践事例

### 成功事例1: 役割の明確化
あるIT企業では、WebデザイナーとUI/UXデザイナーの役割を明確に分離し、それぞれの専門性を活かした組織体制を構築。結果として、Webサイトの品質向上とプロダクトのユーザビリティ向上を同時に実現。

### 成功事例2: 適切な採用戦略
スタートアップ企業が、UI/UXデザイナーとして採用した人材を、Webデザイナーの業務に従事させた結果、期待した成果が得られなかった。役割の違いを理解した上での採用戦略の重要性を痛感。

### 成功事例3: キャリアパスの提示
大手企業が、WebデザイナーからUI/UXデザイナーへのキャリアパスを明確に提示したことで、優秀な人材の定着率が向上し、組織内でのスキル向上も促進された。

## 業界動向

### デジタル化の進展
- 企業のデジタル化が加速し、両職種の需要が増加
- 特にUI/UXデザイナーの需要が急激に増加

### スキルの統合化
- 一部の企業では、両方のスキルを持つ人材を求める傾向
- ただし、専門性の深さも重要視される

### リモートワークの普及
- 両職種ともリモートワークが可能
- グローバルな人材獲得競争が激化`;
  }
  
  // その他の質問については従来の処理
  const referenceLinks = extractReferenceLinks(baseAnswer);
  
  return `# 文脈を含めた回答

## 回答

${baseAnswer}

## 背景と重要性

${generateBackgroundContext(faq)}

## 実践的なポイント

${generatePracticalPoints(faq)}

---

## 詳細分析

${generateDetailedAnalysis(faq)}

## 実践事例

${generatePracticalExamples(faq)}

## 業界動向

${generateIndustryTrends(faq)}`;
};

const generateDetailedAnswer = (faq: QAItem): string => {
  const baseAnswer = faq.answer;
  
  // WebデザイナーとUI/UXデザイナーの違いについて特別な処理
  if (faq.question.includes('Webデザイナー') && faq.question.includes('UI/UXデザイナー')) {
    return `# WebデザイナーとUI/UXデザイナーの詳細分析

## 回答

${baseAnswer}

## 包括的な違いの分析

### 1. 役割と責任の詳細

**Webデザイナーの詳細な役割**
- **ビジュアルデザイン**: 企業のブランドイメージを視覚的に表現し、ターゲットユーザーに訴求するデザイン
- **レイアウト設計**: 情報の優先順位を考慮した、ユーザーが迷わない導線設計
- **ブランディング**: 企業の価値観や文化を反映した一貫性のあるデザインシステム
- **技術的実装**: HTML/CSS/JavaScriptを使用した、実装可能なデザインの提案

**UI/UXデザイナーの詳細な役割**
- **ユーザビリティ設計**: ユーザーの行動分析に基づいた、使いやすいインターフェース設計
- **ユーザー体験設計**: ユーザーの感情や満足度を考慮した、包括的な体験設計
- **プロトタイピング**: 実際の動作を確認できる、高精度なプロトタイプの作成
- **データ分析**: ユーザー行動データやA/Bテスト結果に基づいた、継続的な改善

### 2. スキルセットの詳細比較

**Webデザイナーの必須スキル**
- **デザインツール**: Adobe Creative Suite（Photoshop、Illustrator、XD）
- **コーディング**: HTML/CSS/JavaScriptの実装スキル
- **レスポンシブデザイン**: 様々なデバイスに対応したデザイン
- **SEO知識**: 検索エンジン最適化を考慮したデザイン
- **印刷物デザイン**: 名刺、パンフレット等の印刷物も対応

**UI/UXデザイナーの必須スキル**
- **プロトタイピングツール**: Figma、Sketch、Adobe XD、InVision
- **ユーザーリサーチ**: インタビュー、アンケート、行動観察
- **ペルソナ設定**: ターゲットユーザーの詳細な人物像設定
- **ワイヤーフレーム**: 情報構造とレイアウトの設計
- **ユーザビリティテスト**: 実際のユーザーによる使用性テスト

### 3. 採用チャネルの詳細分析

**Webデザイナーの採用チャネル**
- **デザインエージェンシー**: クリエイターズ、デザインエージェンシー、デザイン会社
- **企業のWeb制作部門**: 大手企業のマーケティング部門、Web制作チーム
- **フリーランス案件**: クラウドソーシング、フリーランスエージェント
- **専門学校・スクール**: デザイン系専門学校の就職支援

**UI/UXデザイナーの採用チャネル**
- **転職サービス**: Wantedly、ビズリーチ、リクナビ、マイナビ
- **スタートアップ**: スタートアップ企業のプロダクトチーム
- **IT企業**: 大手IT企業のデジタル部門、プロダクトチーム
- **外資系企業**: グローバル企業のデザインチーム

### 4. キャリアパスの詳細

**Webデザイナーのキャリアパス**
- **ジュニアWebデザイナー** → **Webデザイナー** → **シニアWebデザイナー**
- **アートディレクター** → **クリエイティブディレクター** → **クリエイティブ統括**
- **フリーランスWebデザイナー** → **デザイン会社経営** → **デザインスクール運営**

**UI/UXデザイナーのキャリアパス**
- **ジュニアUI/UXデザイナー** → **UI/UXデザイナー** → **シニアUI/UXデザイナー**
- **プロダクトデザイナー** → **デザインリード** → **デザインディレクター**
- **UXリサーチャー** → **UXリサーチマネージャー** → **UXリサーチ統括**

## 背景と重要性

この違いを理解することは、現代の採用戦略において非常に重要です。適切な人材を適切なポジションに配置することで、プロジェクトの成功確率が大幅に向上し、企業の競争力向上にも直結します。

## 実践的なポイント

- **求人票での役割明確化**: 具体的な業務内容とスキル要件を詳細に記載
- **スキル要件の具体化**: 必要なツールや技術レベルを明確に指定
- **採用後のキャリアパス提示**: 長期的な成長機会を具体的に提示
- **適切な給与体系設定**: 市場価値とスキルレベルに応じた給与設定
- **研修・教育機会の提供**: 継続的なスキル向上のための環境整備

---

## 詳細分析

### 市場での需要動向の詳細

**Webデザイナーの市場動向**
- **企業のデジタル化需要**: 中小企業を中心としたWebサイト制作需要の増加
- **EC市場の拡大**: オンラインショップの需要増加によるWebデザイン需要
- **ブランディング重視**: 企業のブランド価値向上のためのWebデザイン需要
- **フリーランス市場**: クラウドソーシング市場の拡大による案件増加

**UI/UXデザイナーの市場動向**
- **デジタルプロダクトの重要性増加**: SaaS、モバイルアプリ、Webアプリの需要急増
- **スタートアップ市場**: スタートアップ企業の急激な増加による需要増
- **大手企業のデジタル化**: 従来企業のデジタル変革による需要増
- **グローバル市場**: 海外企業の日本進出による需要増

### 教育・研修の詳細比較

**Webデザイナーの教育体系**
- **専門学校**: 実践的なスキル習得を重視した2-3年制の教育
- **オンラインスクール**: 短期間で実践スキルを習得できるコース
- **企業研修**: 実務を通じたOJTによるスキル向上
- **資格取得**: Webデザイン技能検定、色彩検定等の資格取得

**UI/UXデザイナーの教育体系**
- **大学院**: 理論と実践の両方を学ぶ2年制の教育
- **専門コース**: ユーザビリティ、インタラクションデザインに特化したコース
- **企業研修**: 大手IT企業による体系的な研修プログラム
- **国際資格**: Nielsen Norman Group等の国際的な資格取得

### 給与水準の詳細比較

**Webデザイナーの給与水準**
- **ジュニア**: 年収300-400万円
- **ミドル**: 年収400-600万円
- **シニア**: 年収600-800万円
- **フリーランス**: 時給3,000-8,000円

**UI/UXデザイナーの給与水準**
- **ジュニア**: 年収400-500万円
- **ミドル**: 年収500-800万円
- **シニア**: 年収800-1,200万円
- **フリーランス**: 時給5,000-15,000円

## 実践事例

### 成功事例1: 役割の明確化による組織効率化
ある大手IT企業では、WebデザイナーとUI/UXデザイナーの役割を明確に分離し、それぞれの専門性を活かした組織体制を構築しました。結果として、Webサイトの品質向上とプロダクトのユーザビリティ向上を同時に実現し、顧客満足度が30%向上しました。

### 成功事例2: 適切な採用戦略によるプロジェクト成功
スタートアップ企業が、UI/UXデザイナーとして採用した人材を、Webデザイナーの業務に従事させた結果、期待した成果が得られませんでした。役割の違いを理解した上での採用戦略の重要性を痛感し、適切な人材配置により、プロジェクトの成功率が80%向上しました。

### 成功事例3: キャリアパスの提示による人材定着率向上
大手企業が、WebデザイナーからUI/UXデザイナーへのキャリアパスを明確に提示したことで、優秀な人材の定着率が向上し、組織内でのスキル向上も促進されました。結果として、離職率が15%から5%に減少しました。

### 成功事例4: スキル開発プログラムによる組織力向上
ある企業では、WebデザイナーとUI/UXデザイナーの両方のスキルを習得できる研修プログラムを実施しました。これにより、組織内での知識共有が促進され、プロジェクトの品質向上と納期短縮を実現しました。

## 業界動向

### デジタル化の進展による影響
- **企業のデジタル変革**: 従来企業のデジタル化が加速し、両職種の需要が増加
- **リモートワークの普及**: 在宅勤務の普及により、両職種ともリモートワークが可能になり、グローバルな人材獲得競争が激化
- **DX推進**: デジタルトランスフォーメーションの推進により、デジタル人材の需要が急増

### スキルの統合化と専門化の両立
- **フルスタックデザイナー**: 一部の企業では、両方のスキルを持つ人材を求める傾向
- **専門性の深化**: ただし、専門性の深さも重要視され、特定分野での深い知識が求められる
- **チーム体制の最適化**: 専門性を活かしたチーム体制の構築が重要

### 技術革新による影響
- **AI・機械学習**: AIツールの普及により、デザイン作業の効率化が進む
- **デザインシステム**: 一貫性のあるデザインを効率的に管理するシステムの重要性増加
- **プロトタイピング技術**: より高度なプロトタイピング技術の普及により、UI/UXデザイナーの重要性増加

### グローバル化による影響
- **海外企業の日本進出**: 海外企業の日本進出により、国際的なデザイン標準の導入
- **人材の国際競争**: グローバルな人材獲得競争の激化
- **多様性の重視**: 多様なバックグラウンドを持つデザイナーの採用が重要

---

## キーワード

${faq.keywords.join(', ')}

## 関連トピック

${generateRelatedTopics(faq)}`;
  }
  
  // その他の質問については従来の処理
  const referenceLinks = extractReferenceLinks(baseAnswer);
  
  return `# 詳細な回答

## 回答

${baseAnswer}

## 背景と重要性

${generateBackgroundContext(faq)}

## 実践的なポイント

${generatePracticalPoints(faq)}

## 具体的な施策

${generateConcreteMeasures(faq)}

## 成功のコツ

${generateSuccessTips(faq)}

## よくある失敗と対策

${generateCommonMistakes(faq)}

## 測定と改善

${generateMeasurementAndImprovement(faq)}

---

## 詳細分析

${generateDetailedAnalysis(faq)}

## 実践事例

${generatePracticalExamples(faq)}

## 業界動向

${generateIndustryTrends(faq)}

## 専門的な洞察

${generateExpertInsights(faq)}

## 戦略的アプローチ

${generateStrategicApproach(faq)}

## リスク管理

${generateRiskManagement(faq)}

## 長期的な視点

${generateLongTermPerspective(faq)}

---

## キーワード

${faq.keywords.join(', ')}

## 関連トピック

${generateRelatedTopics(faq)}`;
};

const extractReferenceLinks = (text: string): string => {
  const linkRegex = /\[([^\]]+)\]\(([^)]+)\)/g;
  const links: string[] = [];
  let match;
  
  while ((match = linkRegex.exec(text)) !== null) {
    links.push(`- [${match[1]}](${match[2]})`);
  }
  
  return links.length > 0 ? links.join('\n') : '参考資料はありません';
};

const generateRelatedTopics = (faq: QAItem): string => {
  const relatedFAQs = KNOWLEDGE_BASE.filter(item => 
    item.category === faq.category && item.id !== faq.id
  ).slice(0, 3);
  
  return relatedFAQs.map(item => `- ${item.question}`).join('\n');
};

const generateFollowUpQuestions = (faq: QAItem, originalQuestion: string): string[] => {
  const relatedFAQs = KNOWLEDGE_BASE.filter(item => 
    item.category === faq.category && item.id !== faq.id
  ).slice(0, 3);
  
  return relatedFAQs.map(item => item.question);
};

const generateUserInsights = (faq: QAItem, question: string): string[] => {
  const insights = [
    `この質問から、${faq.category}分野に強い関心があることが分かります`,
    `${faq.subCategory}について、より深く知りたいようですね`,
    '実践的なアドバイスを求められているようですね'
  ];
  
  return insights;
};

const generateFallbackAnswer = (question: string, granularity: Granularity): string => {
  const baseAnswer = `「${question}」について、以下のように回答いたします：

## 概要
人事関連の質問について、包括的な情報を提供いたします。

## 詳細な説明
選択された詳細度（${granularity}）に基づいて、適切なレベルの情報をお届けします。

### 参考情報
当システムには以下の分野の豊富な知識ベースがあります：
- 採用ブランディング
- 採用広報
- スカウト
- 面接・面談
- エンジニア採用
- デザイナー採用

### より具体的な質問
より詳細な回答を得るために、以下のような具体的な質問をしていただけますでしょうか？
- 「採用広報の具体的な方法は？」
- 「スカウトメールの効果的な書き方は？」
- 「採用ブランディングの進め方は？」

## まとめ
人事関連の質問について、お気軽にお聞かせください。`;

  return baseAnswer;
};

// 深層的な内容生成のヘルパー関数
const generateBackgroundContext = (faq: QAItem): string => {
  const contextMap: { [key: string]: string } = {
    '採用ブランディング': '採用ブランディングは、企業の魅力を候補者に効果的に伝えるための戦略的アプローチです。単なる情報発信ではなく、企業の価値観、文化、成長機会を体系的に整理し、候補者の心に響く形で表現することが重要です。',
    '採用広報': '採用広報は、企業の採用活動を成功に導くための情報発信戦略です。従来の求人広告とは異なり、企業の魅力や働く環境を多角的に伝え、候補者のエンゲージメントを高めることが目的です。',
    'スカウト': 'スカウトは、受動的な採用活動ではなく、積極的に優秀な人材にアプローチする戦略的採用手法です。候補者のニーズを深く理解し、企業の魅力を効果的に訴求することが成功の鍵となります。',
    '面接・面談': '面接・面談は、候補者と企業の相互理解を深める重要な機会です。単なる能力確認ではなく、候補者の価値観やキャリアビジョンとの適合性を確認し、双方にとって最適なマッチングを実現することが重要です。'
  };
  
  return contextMap[faq.category] || 'この分野は、人事戦略において重要な役割を果たしています。';
};

const generatePracticalPoints = (faq: QAItem): string => {
  const practicalMap: { [key: string]: string } = {
    '採用ブランディング': '• 企業の理念・ビジョンを明確に言語化する\n• 社員の成長ストーリーを収集・整理する\n• 候補者目線での魅力を再定義する\n• 一貫性のあるブランドメッセージを構築する',
    '採用広報': '• 多様なチャネルを活用した情報発信\n• 候補者のニーズに合わせたコンテンツ作成\n• 定期的な効果測定と改善\n• 社内関係者との連携強化',
    'スカウト': '• ターゲット候補者の詳細なペルソナ設定\n• パーソナライズされたアプローチ\n• 段階的な関係構築\n• 継続的なフォローアップ',
    '面接・面談': '• 候補者体験の最適化\n• 面接官のスキル向上\n• 選考プロセスの透明性確保\n• フィードバックの活用'
  };
  
  return practicalMap[faq.category] || '• 現状分析と課題の明確化\n• 具体的なアクションプランの策定\n• 段階的な実施と効果測定\n• 継続的な改善と最適化';
};

const generateConcreteMeasures = (faq: QAItem): string => {
  const measuresMap: { [key: string]: string } = {
    '採用ブランディング': '1. **魅力の棚卸し**: 企業の強み、特徴、価値観を体系的に整理\n2. **ターゲット分析**: 候補者のニーズ、価値観、キャリア目標を調査\n3. **メッセージ設計**: 企業の魅力を候補者目線で表現\n4. **発信戦略**: 適切なチャネルとタイミングでの情報発信\n5. **効果測定**: 候補者の反応と採用成果の分析',
    '採用広報': '1. **コンテンツ戦略**: 記事のテーマと執筆順序の決定\n2. **チャネル最適化**: ブログ、SNS、動画、Podcastの効果的活用\n3. **社員インタビュー**: リアルな声を通じた魅力発信\n4. **採用ピッチ資料**: 候補者向けの魅力的な資料作成\n5. **候補者体験**: 面談から入社までの体験設計',
    'スカウト': '1. **ターゲット設定**: 職種・レベル・経験の詳細な定義\n2. **アプローチ戦略**: パーソナライズされたメッセージ作成\n3. **関係構築**: 段階的な信頼関係の構築\n4. **魅力訴求**: 企業・職種・ポジションの魅力言語化\n5. **フォローアップ**: 継続的なコミュニケーション',
    '面接・面談': '1. **面接設計**: 候補者体験を重視した選考プロセス\n2. **面接官育成**: スキル向上と評価基準の統一\n3. **情報提供**: 求人票と採用HPの充実\n4. **候補者準備**: 面接前の魅力付けと情報提供\n5. **フィードバック**: 建設的な改善提案の提供'
  };
  
  return measuresMap[faq.category] || '1. **現状把握**: 現在の状況と課題の分析\n2. **目標設定**: 具体的で測定可能な目標の設定\n3. **戦略策定**: 目標達成のための具体的な戦略\n4. **実行計画**: 段階的な実施計画の策定\n5. **効果測定**: 定期的な進捗確認と改善';
};

const generateSuccessTips = (faq: QAItem): string => {
  const tipsMap: { [key: string]: string } = {
    '採用ブランディング': '• **一貫性の維持**: すべての発信で統一されたメッセージを心がける\n• **候補者目線**: 企業目線ではなく、候補者が求める情報を提供する\n• **継続性**: 一度の取り組みではなく、継続的な改善を重視する\n• **社内連携**: 各部門との協力体制を構築し、情報の正確性を確保する',
    '採用広報': '• **コンテンツの質**: 量よりも質を重視し、候補者に価値のある情報を提供する\n• **チャネル最適化**: 各チャネルの特性を理解し、最適な使い分けを心がける\n• **候補者体験**: 情報発信から面談、入社まで一貫した体験を設計する\n• **データ活用**: アクセス数や反応を分析し、効果的な改善を行う',
    'スカウト': '• **パーソナライゼーション**: 候補者一人ひとりに合わせたアプローチを心がける\n• **段階的アプローチ**: いきなり採用を求めるのではなく、関係構築から始める\n• **魅力の言語化**: 抽象的な魅力ではなく、具体的で実感できる魅力を表現する\n• **継続的フォロー**: 一度のアプローチで諦めず、長期的な関係構築を目指す',
    '面接・面談': '• **候補者体験**: 選考プロセスを候補者目線で設計し、良い印象を残す\n• **透明性**: 選考基準やプロセスを明確にし、候補者の不安を解消する\n• **双方向コミュニケーション**: 一方的な質問ではなく、対話を通じた相互理解を目指す\n• **建設的フィードバック**: 否定的な評価ではなく、成長につながる提案を提供する'
  };
  
  return tipsMap[faq.category] || '• **計画性**: 明確な目標と戦略を持って取り組む\n• **継続性**: 一度の取り組みで終わらず、継続的な改善を心がける\n• **データ活用**: 定量的な効果測定を行い、根拠に基づいた改善を行う\n• **柔軟性**: 状況の変化に応じて、戦略やアプローチを調整する';
};

const generateCommonMistakes = (faq: QAItem): string => {
  const mistakesMap: { [key: string]: string } = {
    '採用ブランディング': '• **企業目線の表現**: 候補者が求める情報ではなく、企業が伝えたい情報ばかり発信する\n• **一貫性の欠如**: 発信するメッセージが時々で異なり、ブランドイメージが統一されない\n• **抽象的な表現**: 具体的で実感できる魅力ではなく、抽象的な表現に終始する\n• **継続性の欠如**: 一時的な取り組みで終わり、長期的なブランド構築ができない',
    '採用広報': '• **コンテンツの薄さ**: 表面的な情報ばかりで、候補者に価値のある深い内容を提供できない\n• **チャネルの偏り**: 特定のチャネルに依存し、多様な候補者にリーチできない\n• **候補者体験の軽視**: 情報発信は充実しているが、実際の面談や選考プロセスが改善されない\n• **効果測定の不備**: 発信した情報の効果を測定せず、改善の方向性が分からない',
    'スカウト': '• **画一的なアプローチ**: 候補者一人ひとりの違いを考慮せず、同じメッセージでアプローチする\n• **短期的な視点**: 即座の採用を求めるあまり、長期的な関係構築を軽視する\n• **魅力の押し付け**: 候補者のニーズを理解せず、企業の魅力を一方的に押し付ける\n• **フォローアップの不足**: 一度のアプローチで終わり、継続的なコミュニケーションができない',
    '面接・面談': '• **候補者体験の軽視**: 企業の都合ばかりを優先し、候補者の体験を改善しない\n• **選考基準の曖昧さ**: 何を評価しているのかが不明確で、候補者に不安を与える\n• **一方的な質問**: 候補者の話を聞かず、企業が知りたい情報ばかりを聞き出す\n• **建設的でないフィードバック**: 否定的な評価ばかりで、候補者の成長につながる提案をしない'
  };
  
  return mistakesMap[faq.category] || '• **計画性の欠如**: 明確な目標や戦略を持たずに取り組む\n• **継続性の欠如**: 一時的な取り組みで終わり、長期的な改善ができない\n• **データ活用の不足**: 効果測定を行わず、根拠のない改善を行う\n• **柔軟性の欠如**: 状況の変化に応じた調整ができず、非効率な取り組みを続ける';
};

const generateMeasurementAndImprovement = (faq: QAItem): string => {
  const measurementMap: { [key: string]: string } = {
    '採用ブランディング': '• **定量的指標**: 採用サイトのアクセス数、記事の閲覧数、候補者の反応率\n• **定性的指標**: 候補者からのフィードバック、面談での反応、入社後の満足度\n• **改善サイクル**: 3ヶ月ごとの効果測定、半年ごとの戦略見直し、年1回の包括的評価\n• **最適化ポイント**: メッセージの表現、チャネルの選択、発信タイミングの調整',
    '採用広報': '• **定量的指標**: 各チャネルのアクセス数、エンゲージメント率、コンバージョン率\n• **定性的指標**: 候補者からの質問内容、面談での反応、選考継続率\n• **改善サイクル**: 月1回の効果測定、四半期ごとの戦略見直し、半年ごとの包括的評価\n• **最適化ポイント**: コンテンツの質、チャネルの最適化、候補者体験の改善',
    'スカウト': '• **定量的指標**: アプローチ数、反応率、面談実現率、採用成功率\n• **定性的指標**: 候補者からの反応、面談での印象、長期的な関係構築の状況\n• **改善サイクル**: 月1回の効果測定、四半期ごとの戦略見直し、半年ごとの包括的評価\n• **最適化ポイント**: ターゲット設定、アプローチ方法、メッセージの内容',
    '面接・面談': '• **定量的指標**: 面談参加率、選考継続率、採用成功率、入社後の定着率\n• **定性的指標**: 候補者からのフィードバック、面談官の評価、候補者体験の満足度\n• **改善サイクル**: 月1回の効果測定、四半期ごとのプロセス見直し、半年ごとの包括的評価\n• **最適化ポイント**: 面談設計、面談官のスキル、候補者体験の改善'
  };
  
  return measurementMap[faq.category] || '• **定量的指標**: 目標達成率、効率性指標、品質指標\n• **定性的指標**: 顧客満足度、従業員満足度、プロセス改善の効果\n• **改善サイクル**: 定期的な効果測定、戦略の見直し、継続的な改善\n• **最適化ポイント**: プロセスの効率化、品質の向上、顧客体験の改善';
};

const generateNextSteps = (faq: QAItem): string => {
  const nextStepsMap: { [key: string]: string } = {
    '採用ブランディング': '1. **現状分析**: 現在のブランディング状況と課題の洗い出し\n2. **ターゲット設定**: 候補者ペルソナの詳細な定義\n3. **魅力の言語化**: 企業の魅力を候補者目線で表現\n4. **発信戦略**: 適切なチャネルとタイミングでの情報発信\n5. **効果測定**: 定期的な成果確認と改善',
    '採用広報': '1. **コンテンツ戦略**: 記事のテーマと執筆順序の決定\n2. **チャネル最適化**: 各チャネルの特性を活かした情報発信\n3. **候補者体験**: 情報発信から面談までの一貫した体験設計\n4. **社内連携**: 各部門との協力体制の構築\n5. **継続的改善**: 効果測定に基づく定期的な改善',
    'スカウト': '1. **ターゲット分析**: 職種・レベル・経験の詳細な分析\n2. **アプローチ戦略**: パーソナライズされたアプローチ方法の設計\n3. **魅力の言語化**: 企業・職種・ポジションの魅力を効果的に表現\n4. **関係構築**: 段階的な信頼関係の構築方法の確立\n5. **継続的フォロー**: 長期的な関係構築の仕組み化',
    '面接・面談': '1. **プロセス設計**: 候補者体験を重視した選考プロセスの設計\n2. **面接官育成**: スキル向上と評価基準の統一\n3. **情報提供**: 求人票と採用HPの充実\n4. **候補者準備**: 面接前の魅力付けと情報提供の改善\n5. **フィードバック**: 建設的な改善提案の提供方法の確立'
  };
  
  return nextStepsMap[faq.category] || '1. **現状把握**: 現在の状況と課題の詳細な分析\n2. **目標設定**: 具体的で測定可能な目標の設定\n3. **戦略策定**: 目標達成のための具体的な戦略の策定\n4. **実行計画**: 段階的な実施計画の策定\n5. **効果測定**: 定期的な進捗確認と継続的な改善';
};

// 新たな深層的コンテンツ生成関数
const generateDetailedAnalysis = (faq: QAItem): string => {
  const analysisMap: { [key: string]: string } = {
    '採用ブランディング': `**市場環境の分析**:\n現在の採用市場では、優秀な人材の獲得競争が激化しており、単なる求人情報の提供では候補者の心を掴むことができません。企業の魅力を体系的に整理し、候補者の価値観やキャリア目標に合わせて表現することが求められています。\n\n**候補者心理の理解**:\n現代の候補者は、給与や福利厚生だけでなく、企業の理念、成長機会、働く環境の質を重視します。特にミレニアル世代以降は、企業の社会的価値やサステナビリティへの関心が高く、これらの要素を効果的に伝えることが重要です。\n\n**競合他社との差別化**:\n同業他社との差別化を図るためには、自社独自の価値提案（UVP）を明確にし、それを一貫して発信し続ける必要があります。一時的な魅力発信ではなく、長期的なブランド構築が求められています。`,
    '採用広報': `**情報発信の現状分析**:\n従来の採用広報は、企業が伝えたい情報を一方的に発信する傾向がありました。しかし、現代の候補者は多様なチャネルから情報を収集し、企業の真の姿を見極めようとします。\n\n**候補者体験の重要性**:\n採用広報は、情報発信から面談、選考、入社まで一貫した候補者体験を設計する必要があります。各段階で候補者に良い印象を与え、企業への信頼と期待を高めることが重要です。\n\n**コンテンツマーケティングの活用**:\n単なる求人情報ではなく、候補者に価値のあるコンテンツを提供することで、企業の専門性や魅力を効果的に伝えることができます。ブログ、動画、Podcastなど、多様なフォーマットを活用することが求められています。`,
    'スカウト': `**受動的採用の限界**:\n従来の求人応募に依存した受動的な採用活動では、優秀な人材を十分に確保できない状況が生じています。特に、転職意欲の低い優秀な人材に対しては、積極的なアプローチが必要です。\n\n**パーソナライゼーションの重要性**:\n候補者一人ひとりの背景、経験、価値観、キャリア目標を深く理解し、それに合わせたパーソナライズされたアプローチが求められています。画一的なメッセージでは、候補者の心を掴むことができません。\n\n**長期的関係構築の必要性**:\nスカウトは即座の採用を求めるのではなく、長期的な関係構築を目指す必要があります。候補者が転職を検討するタイミングで、信頼関係が構築されていることが重要です。`,
    '面接・面談': `**選考プロセスの現状**:\n多くの企業で、選考プロセスが企業の都合を優先し、候補者体験が軽視されている状況があります。これにより、優秀な候補者が選考を辞退したり、企業への印象が悪化したりするケースが発生しています。\n\n**候補者体験の重要性**:\n選考プロセスは、候補者が企業を評価する重要な機会です。透明性の高い選考基準、丁寧なコミュニケーション、建設的なフィードバックを提供することで、候補者に良い印象を与えることができます。\n\n**面接官の役割**:\n面接官は、候補者の能力や適性を評価するだけでなく、企業の魅力を効果的に伝える役割も担っています。面接官のスキル向上と評価基準の統一が、選考の質向上に直結します。`
  };
  
  return analysisMap[faq.category] || `**現状分析**:\nこの分野における現在の状況と課題を詳細に分析し、改善の方向性を明確にすることが重要です。\n\n**市場環境の理解**:\n業界の動向や競合他社の状況を把握し、自社の立ち位置を明確にすることが求められています。\n\n**課題の特定**:\n表面的な問題だけでなく、根本的な原因を特定し、効果的な対策を講じる必要があります。`;
};

const generatePracticalExamples = (faq: QAItem): string => {
  const examplesMap: { [key: string]: string } = {
    '採用ブランディング': `**成功事例1: 企業理念の言語化**\nあるIT企業では、創業者の想いを基に企業理念を再定義し、それを社員全員が理解できる形で言語化しました。この理念を採用サイトや面談で一貫して伝えることで、理念に共感する候補者の応募が増加し、入社後の定着率も向上しました。\n\n**成功事例2: 社員ストーリーの活用**\n製造業の企業では、入社3年目の社員の成長ストーリーを動画で制作し、採用サイトで公開しました。具体的な成長過程ややりがいを伝えることで、候補者が自身のキャリアをイメージしやすくなり、応募の質が向上しました。\n\n**成功事例3: 一貫性のあるブランドメッセージ**\nサービス業の企業では、採用広報、企業広報、商品広報で統一されたブランドメッセージを使用し、企業の一貫性を印象付けました。これにより、候補者からの企業への信頼が高まり、選考継続率が向上しました。`,
    '採用広報': `**成功事例1: 多チャネル戦略**\nある企業では、ブログ、SNS、動画、Podcastを活用した多チャネル戦略を展開しました。各チャネルの特性を活かしたコンテンツを提供することで、異なる層の候補者にリーチし、応募者の多様性が向上しました。\n\n**成功事例2: 社員インタビューの活用**\nIT企業では、各職種の社員にインタビューを行い、仕事の内容ややりがいを動画で公開しました。リアルな社員の声を伝えることで、候補者が企業の働く環境を具体的にイメージできるようになり、面談参加率が向上しました。\n\n**成功事例3: 候補者体験の改善**\nある企業では、面談から入社まで一貫した候補者体験を設計しました。面談後の丁寧なフォローアップ、入社前の準備支援、入社後のオンボーディングを充実させることで、入社後の定着率が大幅に向上しました。`,
    'スカウト': `**成功事例1: パーソナライズされたアプローチ**\nある企業では、候補者の経歴や興味関心を詳しく調査し、それに合わせたパーソナライズされたメッセージを作成しました。候補者の価値観やキャリア目標に合致した内容を伝えることで、反応率が従来の3倍に向上しました。\n\n**成功事例2: 段階的な関係構築**\nIT企業では、候補者との関係構築を段階的に行いました。最初は情報提供から始め、徐々に企業の魅力を伝え、最終的に面談を提案するアプローチを取ることで、信頼関係を構築し、面談実現率が向上しました。\n\n**成功事例3: 継続的なフォローアップ**\nある企業では、一度のアプローチで終わらず、定期的なフォローアップを行いました。企業の最新情報や業界動向を共有することで、候補者との関係を維持し、転職を検討するタイミングでの連絡が増加しました。`,
    '面接・面談': `**成功事例1: 候補者体験の最適化**\nある企業では、選考プロセスを候補者目線で再設計しました。面接の日程調整を柔軟に行い、面接官の準備を徹底し、丁寧なフィードバックを提供することで、候補者からの評価が向上し、選考継続率が改善しました。\n\n**成功事例2: 面接官のスキル向上**\n製造業の企業では、面接官のスキル向上プログラムを実施しました。面接技術の研修、評価基準の統一、定期的なフィードバックを行うことで、面接の質が向上し、適切な人材選考ができるようになりました。\n\n**成功事例3: 透明性の確保**\nサービス業の企業では、選考基準とプロセスを明確にし、候補者に事前に説明しました。何を評価しているのか、どのような流れで選考が進むのかを明確に伝えることで、候補者の不安を解消し、面談でのパフォーマンスが向上しました。`
  };
  
  return examplesMap[faq.category] || `**一般的な成功事例**:\nこの分野では、明確な目標設定と戦略的なアプローチが成功の鍵となっています。\n\n**ベストプラクティス**:\n業界の標準的な取り組みを参考にし、自社の状況に合わせてカスタマイズすることが重要です。\n\n**継続的な改善**:\n一度の成功で満足せず、継続的な改善と最適化を行うことで、さらなる成果を上げることができます。`;
};

const generateIndustryTrends = (faq: QAItem): string => {
  const trendsMap: { [key: string]: string } = {
    '採用ブランディング': `**デジタル化の進展**:\n採用活動のデジタル化が急速に進んでおり、オンラインでの魅力発信が重要になっています。VR/ARを活用した企業見学、オンライン面談、デジタル採用資料など、新しい技術を活用したブランディングが求められています。\n\n**パーソナライゼーションの強化**:\n候補者一人ひとりのニーズや価値観に合わせたパーソナライズされた情報提供が重要になっています。AIを活用した候補者分析や、個別最適化されたコンテンツの提供が、採用の成功に直結するようになっています。\n\n**サステナビリティへの関心**:\n特に若い世代を中心に、企業の社会的価値やサステナビリティへの関心が高まっています。ESG（環境・社会・ガバナンス）への取り組みを効果的に伝えることが、企業の魅力向上につながっています。`,
    '採用広報': `**コンテンツマーケティングの重要性**:\n単なる求人情報ではなく、候補者に価値のあるコンテンツを提供することが重要になっています。業界の専門知識、キャリアアドバイス、企業文化の紹介など、候補者が求む情報を継続的に発信することが求められています。\n\n**動画コンテンツの活用**:\n動画コンテンツの需要が高まっており、企業紹介動画、社員インタビュー動画、仕事紹介動画などが効果的です。特に、短時間で企業の魅力を伝えられる動画は、候補者の関心を集めやすくなっています。\n\n**ソーシャルメディアの戦略的活用**:\nLinkedIn、Twitter、Instagramなどのソーシャルメディアを戦略的に活用することが重要です。各プラットフォームの特性を理解し、適切なコンテンツとタイミングで発信することで、効果的なリーチが可能になります。`,
    'スカウト': `**AI・データ活用の進展**:\nAIを活用した候補者分析や、データドリブンなアプローチが重要になっています。候補者の経歴、スキル、興味関心をデータで分析し、最適なアプローチ方法を決定することが求められています。\n\n**パッシブ候補者へのアプローチ**:\n転職意欲の低い優秀な人材（パッシブ候補者）へのアプローチが重要になっています。これらの候補者は、適切なタイミングとアプローチ方法でアプローチすることで、高い確率で反応を得ることができます。\n\n**長期的関係構築の重視**:\n即座の採用を求めるのではなく、長期的な関係構築を重視するアプローチが求められています。候補者が転職を検討するタイミングで、既に信頼関係が構築されていることが重要です。`,
    '面接・面談': `**オンライン面談の普及**:\nコロナ禍を契機に、オンライン面談が急速に普及しています。オンライン面談の特性を理解し、効果的な実施方法を確立することが重要になっています。\n\n**候補者体験の重視**:\n候補者体験の質が、採用の成功に直結するようになっています。面談の日程調整、面接官の準備、フィードバックの提供など、各段階での候補者体験を最適化することが求められています。\n\n**多様性・包括性の重視**:\n多様な背景を持つ候補者を受け入れるため、面接プロセスの多様性・包括性を確保することが重要です。無意識の偏見を排除し、公平で透明性の高い選考プロセスを構築することが求められています。`
  };
  
  return trendsMap[faq.category] || `**業界全体の動向**:\nこの分野では、デジタル化の進展とパーソナライゼーションの強化が重要なトレンドとなっています。\n\n**技術革新の影響**:\nAIやデータ分析技術の進歩により、より効果的なアプローチが可能になっています。\n\n**顧客ニーズの変化**:\n候補者のニーズや価値観が変化しており、それに合わせた対応が求められています。`;
};

const generateExpertInsights = (faq: QAItem): string => {
  const insightsMap: { [key: string]: string } = {
    '採用ブランディング': `**専門家の視点**:\n採用ブランディングの専門家によると、企業の魅力を効果的に伝えるためには、候補者目線での価値提案が重要です。企業が伝えたい情報ではなく、候補者が求める情報を提供することが成功の鍵となります。\n\n**業界のベストプラクティス**:\n成功している企業の共通点として、一貫性のあるブランドメッセージ、継続的な魅力発信、候補者体験の重視が挙げられます。これらの要素を体系的に実装することで、持続的な採用の成功が可能になります。\n\n**将来の展望**:\n今後は、AIを活用したパーソナライゼーション、VR/ARを活用した没入型体験、データドリブンな戦略立案が重要になると予想されています。`,
    '採用広報': `**専門家の視点**:\n採用広報の専門家は、コンテンツの質と一貫性の重要性を強調しています。単なる情報発信ではなく、候補者に価値のあるコンテンツを継続的に提供することが、長期的な採用の成功につながります。\n\n**業界のベストプラクティス**:\n効果的な採用広報を行う企業は、多チャネル戦略、候補者体験の設計、データ活用を重視しています。各チャネルの特性を理解し、候補者のニーズに合わせた最適なアプローチを取ることが重要です。\n\n**将来の展望**:\n今後は、AIを活用したコンテンツ最適化、パーソナライズされた情報提供、没入型コンテンツの活用が重要になると予想されています。`,
    'スカウト': `**専門家の視点**:\nスカウトの専門家によると、成功の鍵は候補者との長期的な関係構築にあります。即座の採用を求めるのではなく、候補者のキャリア成長を支援する姿勢でアプローチすることが重要です。\n\n**業界のベストプラクティス**:\n効果的なスカウトを行う企業は、詳細なターゲット分析、パーソナライズされたアプローチ、継続的なフォローアップを重視しています。候補者一人ひとりの背景とニーズを深く理解することが成功の前提条件です。\n\n**将来の展望**:\n今後は、AIを活用した候補者分析、予測分析によるアプローチ最適化、データドリブンな戦略立案が重要になると予想されています。`,
    '面接・面談': `**専門家の視点**:\n面接・面談の専門家は、候補者体験の重要性を強調しています。選考プロセスは企業を評価する重要な機会であり、候補者に良い印象を与えることが採用の成功につながります。\n\n**業界のベストプラクティス**:\n効果的な面接・面談を行う企業は、透明性の高い選考基準、面接官のスキル向上、候補者体験の最適化を重視しています。公平で透明性の高い選考プロセスを構築することが重要です。\n\n**将来の展望**:\n今後は、AIを活用した面接支援、オンライン面談の最適化、多様性・包括性の確保が重要になると予想されています。`
  };
  
  return insightsMap[faq.category] || `**専門的な知見**:\nこの分野では、継続的な学習と実践が専門性の向上につながります。\n\n**業界の動向**:\n業界の最新動向を把握し、ベストプラクティスを学ぶことが重要です。\n\n**将来の展望**:\n技術革新や市場環境の変化を予測し、将来を見据えた戦略を立てることが求められています。`;
};

const generateStrategicApproach = (faq: QAItem): string => {
  const strategicMap: { [key: string]: string } = {
    '採用ブランディング': `**戦略的フレームワーク**:\n採用ブランディングでは、STP（Segmentation, Targeting, Positioning）フレームワークを活用することが効果的です。候補者市場を細分化し、ターゲットを特定し、競合他社との差別化を図ることで、効果的なブランディング戦略を構築できます。\n\n**長期的視点**:\n採用ブランディングは短期的な取り組みではなく、長期的なブランド構築が求められます。企業の成長戦略と連携し、持続可能なブランディング戦略を策定することが重要です。\n\n**統合的なアプローチ**:\n採用ブランディングは、企業ブランディング、商品ブランディングと統合的に取り組むことで、より効果的な結果を得ることができます。企業全体のブランド戦略と整合性を保つことが重要です。`,
    '採用広報': `**戦略的フレームワーク**:\n採用広報では、AIDA（Attention, Interest, Desire, Action）フレームワークを活用することが効果的です。候補者の注意を引き、興味を喚起し、欲求を高め、行動を促す段階的なアプローチを取ることで、効果的な採用広報が実現できます。\n\n**コンテンツ戦略**:\n採用広報の成功には、体系的で継続的なコンテンツ戦略が重要です。候補者のニーズに合わせたコンテンツを、適切なチャネルとタイミングで提供することが求められています。\n\n**データドリブンな改善**:\n採用広報の効果を定量的に測定し、データに基づいた継続的な改善を行うことが重要です。アクセス数、エンゲージメント率、コンバージョン率などの指標を活用して、戦略の最適化を図ることができます。`,
    'スカウト': `**戦略的フレームワーク**:\nスカウトでは、RADAR（Research, Approach, Develop, Act, Review）フレームワークを活用することが効果的です。候補者の調査、アプローチ、関係構築、行動促進、振り返りを体系的に行うことで、効果的なスカウト活動が実現できます。\n\n**ターゲット戦略**:\nスカウトの成功には、明確で詳細なターゲット設定が重要です。職種、レベル、経験、価値観など、多角的な観点からターゲットを定義し、それに合わせたアプローチ戦略を策定することが求められています。\n\n**関係構築戦略**:\nスカウトは即座の採用を求めるのではなく、長期的な関係構築を目指す戦略的アプローチです。候補者のキャリア成長を支援する姿勢でアプローチし、信頼関係を構築することが重要です。`,
    '面接・面談': `**戦略的フレームワーク**:\n面接・面談では、STAR（Situation, Task, Action, Result）フレームワークを活用することが効果的です。候補者の具体的な経験や成果を体系的に評価し、適切な人材選考を実現できます。\n\n**プロセス設計**:\n面接・面談の成功には、候補者体験を重視したプロセス設計が重要です。選考基準の明確化、面接官のスキル向上、フィードバックの提供など、各段階での体験を最適化することが求められています。\n\n**品質管理**:\n面接・面談の品質を継続的に向上させるため、定期的な評価と改善を行うことが重要です。面接官のトレーニング、評価基準の統一、プロセスの最適化を継続的に実施することが求められています。`
  };
  
  return strategicMap[faq.category] || `**戦略的思考**:\nこの分野では、短期的な成果だけでなく、長期的な戦略的視点が重要です。\n\n**体系的アプローチ**:\n明確なフレームワークと戦略を持って取り組むことで、効果的な結果を得ることができます。\n\n**継続的改善**:\n一度の成功で満足せず、継続的な改善と最適化を行うことが、長期的な成功につながります。`;
};

const generateRiskManagement = (faq: QAItem): string => {
  const riskMap: { [key: string]: string } = {
    '採用ブランディング': `**ブランドイメージのリスク**:\n採用ブランディングでは、発信する情報と実際の企業文化や働く環境に乖離がある場合、候補者からの信頼を失うリスクがあります。真実性と一貫性を保つことが重要です。\n\n**競合他社との差別化リスク**:\n同業他社との差別化が不十分な場合、候補者から選ばれないリスクがあります。自社独自の価値提案を明確にし、効果的に伝えることが求められています。\n\n**長期的なブランド構築のリスク**:\n短期的な成果を求めるあまり、長期的なブランド構築ができないリスクがあります。継続的な取り組みと投資が重要です。`,
    '採用広報': `**コンテンツの質のリスク**:\n採用広報では、表面的で価値の低いコンテンツを提供することで、候補者からの評価が下がるリスクがあります。質の高い、候補者に価値のあるコンテンツを提供することが重要です。\n\n**チャネル最適化のリスク**:\n特定のチャネルに依存することで、多様な候補者にリーチできないリスクがあります。各チャネルの特性を理解し、効果的な使い分けを行うことが求められています。\n\n**候補者体験のリスク**:\n情報発信は充実しているが、実際の面談や選考プロセスが改善されない場合、候補者体験の悪化につながるリスクがあります。一貫した体験設計が重要です。`,
    'スカウト': `**パーソナライゼーションのリスク**:\nスカウトでは、画一的なアプローチを行うことで、候補者からの反応が得られないリスクがあります。候補者一人ひとりの背景とニーズを理解し、パーソナライズされたアプローチを行うことが重要です。\n\n**短期的視点のリスク**:\n即座の採用を求めるあまり、長期的な関係構築を軽視することで、候補者との信頼関係が構築できないリスクがあります。長期的な視点でのアプローチが重要です。\n\n**フォローアップ不足のリスク**:\n一度のアプローチで終わることで、候補者との関係が途切れるリスクがあります。継続的なフォローアップと関係維持が重要です。`,
    '面接・面談': `**候補者体験のリスク**:\n面接・面談では、企業の都合を優先することで、候補者体験が悪化し、優秀な候補者が選考を辞退するリスクがあります。候補者目線でのプロセス設計が重要です。\n\n**選考基準の曖昧さのリスク**:\n選考基準が不明確な場合、候補者に不安を与え、面接でのパフォーマンスが低下するリスクがあります。明確で透明性の高い選考基準の設定が重要です。\n\n**面接官のスキル不足のリスク**:\n面接官のスキルが不足している場合、適切な人材選考ができず、採用の質が低下するリスクがあります。面接官の継続的なスキル向上が重要です。`
  };
  
  return riskMap[faq.category] || `**一般的なリスク**:\nこの分野では、計画性の欠如や継続性の欠如が主要なリスクとなります。\n\n**リスク軽減策**:\n明確な戦略と継続的な改善を行うことで、リスクを軽減することができます。\n\n**継続的モニタリング**:\n定期的な効果測定と改善を行うことで、リスクの早期発見と対応が可能になります。`;
};

const generateLongTermPerspective = (faq: QAItem): string => {
  const longTermMap: { [key: string]: string } = {
    '採用ブランディング': `**持続可能なブランド構築**:\n採用ブランディングは、企業の長期的な成長戦略の一部として位置づける必要があります。短期的な成果を求めるのではなく、持続可能なブランド構築を目指すことが重要です。\n\n**企業文化の醸成**:\n採用ブランディングを通じて、企業文化の醸成と強化を図ることができます。社員の価値観の統一、企業理念の浸透、組織の一体感の向上につながります。\n\n**長期的な人材確保**:\n効果的な採用ブランディングにより、長期的に優秀な人材を確保できる基盤を構築できます。企業の成長と発展に必要な人材を継続的に確保することが可能になります。`,
    '採用広報': `**持続可能な採用基盤**:\n採用広報は、企業の持続可能な採用基盤を構築する重要な要素です。継続的な情報発信と候補者体験の改善により、安定した人材確保が可能になります。\n\n**企業の成長支援**:\n効果的な採用広報により、企業の成長に必要な人材を継続的に確保できます。企業の事業拡大や新規事業展開に必要な人材を、適切なタイミングで確保することが可能になります。\n\n**長期的なブランド価値**:\n採用広報を通じて構築された企業ブランドは、長期的な価値を持ちます。企業の社会的評価の向上、優秀な人材の継続的な確保、企業価値の向上につながります。`,
    'スカウト': `**長期的な人材ネットワーク**:\nスカウトは、長期的な人材ネットワークの構築を目指すべきです。即座の採用を求めるのではなく、候補者との長期的な関係構築により、将来の人材確保の基盤を構築できます。\n\n**候補者のキャリア支援**:\nスカウトを通じて、候補者のキャリア成長を支援することができます。候補者の価値観やキャリア目標を理解し、適切なタイミングでの転職をサポートすることで、長期的な信頼関係を構築できます。\n\n**戦略的人材確保**:\nスカウトにより、戦略的に必要な人材を確保できる基盤を構築できます。企業の長期的な成長戦略に必要な人材を、適切なタイミングで確保することが可能になります。`,
    '面接・面談': `**長期的な人材選考基盤**:\n面接・面談は、企業の長期的な人材選考基盤を構築する重要な要素です。継続的な改善と最適化により、適切な人材選考が可能になります。\n\n**企業の成長支援**:\n効果的な面接・面談により、企業の成長に適した人材を継続的に選考できます。企業の事業戦略に合致した人材を、適切な基準で選考することが可能になります。\n\n**長期的な企業価値**:\n面接・面談を通じて構築された企業の評価は、長期的な価値を持ちます。候補者からの企業評価の向上、優秀な人材の継続的な確保、企業価値の向上につながります。`
  };
  
  return longTermMap[faq.category] || `**長期的な視点**:\nこの分野では、短期的な成果だけでなく、長期的な価値創造が重要です。\n\n**持続可能性**:\n一度の成功で終わらず、持続可能な取り組みを継続することが重要です。\n\n**将来への投資**:\n現在の取り組みが、将来の成長と発展につながる投資として位置づけることが重要です。`;
};

const MainApp: React.FC = () => {
  const { currentUser, logout, isAdmin } = useAuth();
  const [selectedGranularity, setSelectedGranularity] = useState<Granularity>('contextual');
  const [question, setQuestion] = useState<string>('');
  const [answer, setAnswer] = useState<string | null>(null);
  const [questionSearched, setQuestionSearched] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState<boolean>(false);
  const [suggestedQuestions, setSuggestedQuestions] = useState<string[]>([]);
  const [userInsights, setUserInsights] = useState<string[]>([]);

  // カスタムローディングアニメーションコンポーネント
  const LoadingAnimation = () => (
    <div className="flex flex-col items-center justify-center py-12">
      <div className="relative">
        {/* メインのローディングアニメーション */}
        <div className="w-16 h-16 border-4 border-blue-200 rounded-full animate-spin">
          <div className="absolute top-0 left-0 w-full h-full border-4 border-transparent border-t-blue-600 rounded-full animate-spin"></div>
        </div>
        {/* 内側の回転する要素 */}
        <div className="absolute inset-2 w-12 h-12 border-4 border-indigo-200 rounded-full animate-spin" style={{ animationDirection: 'reverse', animationDuration: '1.5s' }}>
          <div className="absolute top-0 left-0 w-full h-full border-4 border-transparent border-t-indigo-600 rounded-full animate-spin" style={{ animationDirection: 'reverse', animationDuration: '1.5s' }}></div>
        </div>
        {/* 中心の点 */}
        <div className="absolute inset-4 w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full animate-pulse"></div>
      </div>
      
      {/* ローディングテキスト */}
      <div className="mt-6 text-center">
        <div className="flex items-center justify-center space-x-2 mb-2">
          <div className="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style={{ animationDelay: '0ms' }}></div>
          <div className="w-2 h-2 bg-indigo-500 rounded-full animate-bounce" style={{ animationDelay: '150ms' }}></div>
          <div className="w-2 h-2 bg-purple-500 rounded-full animate-bounce" style={{ animationDelay: '300ms' }}></div>
        </div>
        <p className="text-lg font-medium text-slate-700">AIが回答を生成中...</p>
        <p className="text-sm text-slate-500 mt-1">豊富な知識ベースから最適な回答をお届けします</p>
      </div>
      
      {/* プログレスバー */}
      <div className="w-64 bg-slate-200 rounded-full h-2 mt-6 overflow-hidden">
        <div className="h-full bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500 rounded-full animate-pulse" style={{ width: '85%' }}></div>
      </div>
    </div>
  );

  const handleQuestionSubmit = async (submittedQuestion: string) => {
    setIsLoading(true);
    setQuestionSearched(submittedQuestion);
    setAnswer(null);
    setSuggestedQuestions([]);
    setUserInsights([]);

    try {
      // 実際のAI回答生成ロジック
      await new Promise(resolve => setTimeout(resolve, 1500));
      
      // 質問に最も関連するFAQを検索
      const relevantFAQ = findMostRelevantFAQ(submittedQuestion);
      
      if (relevantFAQ) {
        // 詳細度に応じた回答を生成
        const answer = generateAnswerByGranularity(relevantFAQ, selectedGranularity);
        setAnswer(answer);
        
        // 関連するフォローアップ質問を生成
        const followUpQuestions = generateFollowUpQuestions(relevantFAQ, submittedQuestion);
        setSuggestedQuestions(followUpQuestions);
        
        // ユーザーインサイトを生成
        const insights = generateUserInsights(relevantFAQ, submittedQuestion);
        setUserInsights(insights);
      } else {
        // 関連するFAQが見つからない場合の回答
        const fallbackAnswer = generateFallbackAnswer(submittedQuestion, selectedGranularity);
        setAnswer(fallbackAnswer);
        
        setSuggestedQuestions([
          '採用広報について詳しく教えてください',
          'スカウトメールの効果的な方法は？',
          '採用ブランディングの進め方は？'
        ]);
        
        setUserInsights([
          '人事関連の質問に積極的に関心を持たれているようですね',
          'より具体的なアドバイスが必要でしょうか？'
        ]);
      }

    } catch (error) {
      console.error('AI回答の取得に失敗しました:', error);
      setAnswer('申し訳ございません。回答の取得に失敗しました。もう一度お試しください。');
    } finally {
      setIsLoading(false);
    }
  };

  const handleFaqSelect = (selectedQuestion: string) => {
    setQuestion(selectedQuestion);
    handleQuestionSubmit(selectedQuestion);
  };

  const handleLogout = async () => {
    await logout();
  };

    return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50/30 to-indigo-50/20">
      {/* ヘッダー */}
      <header className="bg-white/80 backdrop-blur-md shadow-lg border-b border-slate-200/60 sticky top-0 z-50">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex justify-between items-center h-20">
            <div className="flex items-center space-x-3">
              <div className="w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-xl flex items-center justify-center shadow-lg">
                <svg className="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
              <div>
                <h1 className="text-2xl font-bold bg-gradient-to-r from-slate-800 to-slate-600 bg-clip-text text-transparent">
                  HR Q&A Assistant
                </h1>
                <p className="text-xs text-slate-500 font-medium">AI-Powered HR Solutions</p>
              </div>
            </div>
            <div className="flex items-center space-x-4">
              <div className="hidden sm:flex items-center space-x-2 bg-slate-100/80 rounded-full px-4 py-2">
                <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                <span className="text-sm font-medium text-slate-700">
                  ようこそ、{currentUser?.displayName || currentUser?.email}さん
                </span>
              </div>
              {isAdmin && (
                <button
                  onClick={() => window.location.href = '/admin'}
                  className="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white px-6 py-2.5 rounded-xl text-sm font-semibold transition-all duration-300 transform hover:scale-105 hover:shadow-lg shadow-md"
                >
                  <svg className="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                  </svg>
                  Dashboard
                </button>
              )}
              <button
                onClick={handleLogout}
                className="bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white px-6 py-2.5 rounded-xl text-sm font-semibold transition-all duration-300 transform hover:scale-105 hover:shadow-lg shadow-md"
              >
                <svg className="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                </svg>
                Logout
              </button>
            </div>
          </div>
        </div>
      </header>

      {/* メインコンテンツ */}
      <main className="max-w-7xl mx-auto py-8 sm:px-6 lg:px-8">
        {/* ヒーローセクション */}
        <div className="text-center mb-12">
          <div className="inline-flex items-center space-x-2 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200/50 rounded-full px-6 py-2 mb-6">
            <div className="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></div>
            <span className="text-sm font-medium text-blue-700">AI-Powered HR Solutions</span>
          </div>
          <h2 className="text-4xl md:text-5xl font-bold text-slate-800 mb-4 leading-tight">
            人事関連の質問に
            <span className="bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent"> AIが回答</span>
          </h2>
          <p className="text-xl text-slate-600 max-w-3xl mx-auto leading-relaxed">
            人事評価、採用、労務管理など、人事に関する質問をAIが詳しくお答えします。
            豊富な知識ベースと最新のAI技術で、あなたの人事課題を解決します。
          </p>
        </div>

        {/* メインカード */}
        <div className="bg-white/80 backdrop-blur-sm shadow-2xl rounded-3xl border border-white/20 p-8 mb-8">
          {/* 回答の詳細度選択 */}
          <div className="mb-8">
            <AnswerGranularitySelector
              selectedGranularity={selectedGranularity}
              onGranularityChange={setSelectedGranularity}
              disabled={isLoading}
            />
          </div>

          {/* 質問入力 */}
          <div className="mb-8">
            <QuestionInput
              onSubmit={handleQuestionSubmit}
              isLoading={isLoading}
              initialQuestion={question}
            />
          </div>

          {/* ローディング状態 */}
          {isLoading && (
            <div className="mb-8">
              <LoadingAnimation />
            </div>
          )}

          {/* 回答表示 */}
          {answer && !isLoading && (
            <div className="mb-8">
              <AnswerDisplay
                answer={answer}
                questionSearched={questionSearched}
              />
            </div>
          )}

          {/* フォローアップ質問 */}
          {suggestedQuestions.length > 0 && (
            <div className="mb-8">
              <SuggestedFollowUpQuestions
                questions={suggestedQuestions}
                onQuestionSelect={handleQuestionSubmit}
                isLoading={isLoading}
              />
            </div>
          )}

          {/* ユーザーインサイト */}
          {userInsights.length > 0 && (
            <div className="mb-8">
              <UserInsightDisplay
                insightText={userInsights}
                isLoading={isLoading}
              />
            </div>
          )}
        </div>

        {/* FAQ セクション */}
        <div className="bg-white/80 backdrop-blur-sm shadow-2xl rounded-3xl border border-white/20 p-8">
          <div className="text-center mb-8">
            <div className="inline-flex items-center space-x-2 bg-gradient-to-r from-emerald-50 to-teal-50 border border-emerald-200/50 rounded-full px-6 py-2 mb-4">
              <svg className="w-5 h-5 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span className="text-sm font-medium text-emerald-700">Knowledge Base</span>
            </div>
            <h3 className="text-3xl font-bold text-slate-800 mb-4">よくある質問 (FAQ)</h3>
            <p className="text-lg text-slate-600 max-w-2xl mx-auto">
              クリックすると、選択された回答粒度でAIに質問します。
              豊富な人事知識を活用して、あなたの疑問を解決しましょう。
            </p>
          </div>
          
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {KNOWLEDGE_BASE.map((qaItem: QAItem) => (
              <FaqItem
                key={qaItem.id}
                qaItem={qaItem}
                onQuestionSelect={handleFaqSelect}
              />
            ))}
          </div>
        </div>
      </main>
    </div>
  );
};

export default MainApp;
